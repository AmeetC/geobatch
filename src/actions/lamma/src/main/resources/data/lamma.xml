<?xml version="1.0" encoding="UTF-8"?>
<FlowConfiguration>
	<id>Lamma Grib Extractor Flow</id>
	<description>Flow to elaborate and extract Lamma Grib data</description>
	<name>LaMMaGribExtractorFlow</name>
	
	<workingDirectory>lamma</workingDirectory>
	<autorun>true</autorun>
	
	<EventConsumerConfiguration>
		<id>id</id>
		<description>description</description>
		<name>test</name>

        <listenerId>ConsumerLogger0</listenerId>
        <listenerId>Cumulator</listenerId>

		<workingDirectory>lamma</workingDirectory>
		<performBackup>true</performBackup>

		<FileEventRule>
			<optional>false</optional>
			<originalOccurrencies>1</originalOccurrencies>
			<regex>.*\.xml</regex>
			<id>r1</id>
			<description>description</description>
			<name>test</name>
		</FileEventRule>

        <TaskExecutorConfiguration>
			<id>wgribInventory</id>
			<description>Flow to run wgrib inventory</description>
			<name>wgribInventory Flow</name>

			<workingDirectory>lamma</workingDirectory>
			<serviceID>TaskExecutorService</serviceID>
			
			<listenerId>StatusActionLogger0</listenerId>
            <listenerId>ActionLogger0</listenerId>
			
			<errorFile>lamma/wgrib/config/errorlog.txt</errorFile>
			<timeOut>1200000</timeOut> <!-- milliseconds -->
			<executable>G:\work\LAMMA\WGRIB\wgrib.exe</executable>
			<output>g:\temp\lamma</output>
			<outputName>*.dump</outputName>
		    <variables>
				  <entry>
				    <string>PATH</string>
				    <string>G:/work/LAMMA/WGRIB</string>
				  </entry>
			</variables>
			<xsl>lamma/wgrib/config/wgrib.xsl</xsl>
		</TaskExecutorConfiguration>

        <LammaGribMetadataExtractorConfiguration>
			<id>lammaGribMetadataExtractor</id>
			<description>Flow to extract metadata from Grib files</description>
			<name>lammaGribMetadataExtractor Flow</name>

			<serviceID>LammaGribMetadataExtractorService</serviceID>
			
			<listenerId>StatusActionLogger0</listenerId>
            <listenerId>ActionLogger0</listenerId>
            
            <baseOutputDir>G:\temp\lamma</baseOutputDir>
            <lammaServiceURL>http://localhost:9090/lamma-service/soap</lammaServiceURL>
		</LammaGribMetadataExtractorConfiguration>
		
        <TaskExecutorConfiguration>
			<id>wgribDump</id>
			<description>Flow to run wgrib dumping</description>
			<name>wgribDump Flow</name>

			<workingDirectory>lamma/gribinventory</workingDirectory>
			<serviceID>TaskExecutorService</serviceID>
			
			<listenerId>StatusActionLogger0</listenerId>
            <listenerId>ActionLogger0</listenerId>
			
			<errorFile>lamma/wgrib/config/errorlog.txt</errorFile>
			<timeOut>1200000</timeOut> <!-- milliseconds -->
			<executable>G:\work\LAMMA\WGRIB\wgrib.exe</executable>
			<output>.</output>
			<outputName>*.header</outputName>
		    <variables>
				  <entry>
				    <string>PATH</string>
				    <string>G:/work/LAMMA/WGRIB</string>
				  </entry>
			</variables>
			<xsl>lamma/wgrib/config/wgrib.xsl</xsl>
		</TaskExecutorConfiguration>

        <LammaGribBuilderConfiguration>
			<id>lammaGribBuilder</id>
			<description>Flow to build GeoTIFF from Grib files</description>
			<name>lammaGribBuilder Flow</name>

			<serviceID>LammaGribBuilderService</serviceID>
			
			<listenerId>StatusActionLogger0</listenerId>
            <listenerId>ActionLogger0</listenerId>
            
            <baseOutputDir>G:\temp\lamma</baseOutputDir>
            <lammaServiceURL>http://localhost:9090/lamma-service/soap</lammaServiceURL>
		</LammaGribBuilderConfiguration>

        <TaskExecutorConfiguration>
			<id>gdalcontour</id>
			<description>Flow to run gdalcontour operations</description>
			<name>gdalcontour flow</name>

			<workingDirectory>lamma/gdalcontour</workingDirectory>
			<serviceID>TaskExecutorService</serviceID>

			<listenerId>StatusActionLogger0</listenerId>
            <listenerId>ActionLogger0</listenerId>

			<errorFile>lamma/gdalcontour/config/errorlog.txt</errorFile>
			<timeOut>1200000</timeOut> <!-- milliseconds -->
			<executable>C:\Program Files\FWTools2.2.8\bin\gdal_contour.exe</executable>
			<defaultScript>lamma/gdalcontour/config/gdalcontour.xml</defaultScript>
			<outputName>*.tif</outputName>
		    <variables>
				 <entry>
				    <string>GDAL_DATA</string>
				    <string>C:/Program Files/FWTools2.2.8/data</string>
				  </entry>
				  <entry>
				    <string>PATH</string>
				    <string>C:/Program Files/FWTools2.2.8/bin</string>
				  </entry>
			</variables>
			<xsl>lamma/gdalcontour/config/gdalcontour.xsl</xsl>
		</TaskExecutorConfiguration>

        <LammaMosaicDataConfiguration>
			<id>lammaMosaicData</id>
			<description>Flow to prepare ImageMosaic directories</description>
			<name>lammaMosaicData Flow</name>

			<serviceID>LammaMosaicDataService</serviceID>
			
			<listenerId>StatusActionLogger0</listenerId>
            <listenerId>ActionLogger0</listenerId>
            
            <baseOutputDir>G:\temp\lamma</baseOutputDir>
            <lammaServiceURL>http://localhost:9090/lamma-service/soap</lammaServiceURL>
		</LammaMosaicDataConfiguration>

		<ImageMosaicActionConfiguration>
			<id>ImageMosaicService</id>
			<description>ImageMosaicService</description>
			<name>ImageMosaicService</name>

			<serviceID>ImageMosaicGeneratorService</serviceID>
			<workingDirectory>lamma/imagemosaic</workingDirectory>

			<listenerId>StatusActionLogger0</listenerId>
            <listenerId>ActionLogger0</listenerId>

			<crs>EPSG:4326</crs>
			<envelope/>
			<dataTransferMethod>EXTERNAL</dataTransferMethod>
			<geoserverPWD>geoserver</geoserverPWD>
			<geoserverUID>admin</geoserverUID>
			<geoserverURL>http://localhost:8080/geoserver</geoserverURL>
			<wmsPath>/</wmsPath>
			<defaultNamespace>lamma</defaultNamespace>
			<defaultStyle>raster</defaultStyle>
			<styles/>
			<datastorePropertiesPath>lamma/imagemosaic/config/datastore.properties</datastorePropertiesPath>
			<timeRegex>[0-9]{8}T[0-9]{7}Z(?!.*[0-9]{8}T[0-9]{7}Z.*)</timeRegex>
			<elevationRegex><![CDATA[(?<=_)(\\d{4}\\.\\d{3})(?=_)]]></elevationRegex>
			<runtimeRegex><![CDATA[(?<=_)(\\d{10})(?=_)]]></runtimeRegex>
		</ImageMosaicActionConfiguration>

        <LammaContourBuilderConfiguration>
			<id>lammaContourBuilder</id>
			<description>Flow to prepare Contour shapefiles</description>
			<name>lammaContourBuilder Flow</name>

			<serviceID>LammaContourBuilderService</serviceID>
			
			<listenerId>StatusActionLogger0</listenerId>
            <listenerId>ActionLogger0</listenerId>
            
            <baseOutputDir>G:\temp\lamma</baseOutputDir>
            <lammaServiceURL>http://localhost:9090/lamma-service/soap</lammaServiceURL>

			<geoserverPWD>geoserver</geoserverPWD>
			<geoserverUID>admin</geoserverUID>
			<geoserverURL>http://localhost:8080/geoserver</geoserverURL>
			<wmsPath>/</wmsPath>
			<defaultNamespace>lamma</defaultNamespace>
			<defaultStyle>contour</defaultStyle>
		</LammaContourBuilderConfiguration>

		<!-- GeoServerRESTActionConfiguration>
            <serviceID>geoServerRESTGeneratorService</serviceID>
            <id>step1</id>
            <name>GeoServerIngestion</name>
            <description>GeoServer REST.</description>

			<listenerId>StatusActionLogger0</listenerId>
            <listenerId>ActionLogger0</listenerId>

            <workingDirectory>lamma</workingDirectory>
            <crs>EPSG:4326</crs>
            <envelope/>
            <dataTransferMethod>DIRECT</dataTransferMethod>
            <vectorialLayer>true</vectorialLayer>
            <geoserverPWD>geoserver</geoserverPWD>
            <geoserverUID>admin</geoserverUID>
            <geoserverURL>http://localhost:8080/geoserver</geoserverURL>
            <geoserverVersion>2.0.0</geoserverVersion>
            <storeType>shp</storeType>
            <wmsPath>/</wmsPath>
            <queryString><![CDATA[timeAttribute=basetime&elevAttribute=elevation]]></queryString>
            <defaultNamespace>lamma</defaultNamespace>
            <defaultStyle>contour</defaultStyle>
            <styles/>
		</GeoServerRESTActionConfiguration -->
		
	</EventConsumerConfiguration>

	<EventGeneratorConfiguration>
		<wildCard>*.*</wildCard>
		<watchDirectory>lamma/in</watchDirectory>
		<osType>OS_UNDEFINED</osType>
		<eventType>FILE_ADDED</eventType>
		<id>id</id>
        <serviceID>fsEventGeneratorService</serviceID>
		<description>description</description>
		<name>test</name>
	</EventGeneratorConfiguration>

    <ListenerConfigurations>
    	<StatusProgressListener>
    		<serviceID>statusListenerService</serviceID>
            <id>StatusActionLogger0</id>
    	</StatusProgressListener>
    	
        <LoggingProgressListener>
            <serviceID>loggingListenerService</serviceID>
            <id>ActionLogger0</id>

            <loggerName>ActionLogger</loggerName>
        </LoggingProgressListener>

        <LoggingProgressListener>
            <serviceID>loggingListenerService</serviceID>
            <id>ConsumerLogger0</id>

            <loggerName>ConsLogger</loggerName>
        </LoggingProgressListener>

        <CumulatingProgressListener>
            <serviceID>cumulatingListenerService</serviceID>
            <id>Cumulator</id>
        </CumulatingProgressListener>
    </ListenerConfigurations>
    
</FlowConfiguration>