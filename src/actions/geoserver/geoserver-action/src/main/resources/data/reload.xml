<?xml version="1.0" encoding="UTF-8"?>
<FlowConfiguration>
	<id>reload</id>
	<name>Prepare  and publish</name>
	<description>Create overviews, retile the image and publish on GeoServer</description>
	
	<corePoolSize>5</corePoolSize>
	<maximumPoolSize>30</maximumPoolSize>
	<keepAliveTime>1500</keepAliveTime>
	<workQueueSize>100</workQueueSize>
	
	<workingDirectory>reload</workingDirectory>
	<autorun>true</autorun>
	
	<EventGeneratorConfiguration>
		<wildCard>*.grb</wildCard>
		<watchDirectory>/opt/ingestion/</watchDirectory>
		<osType>OS_UNDEFINED</osType>
		<eventType>FILE_ADDED</eventType>
		<id>id</id>
		<serviceID>fsEventGeneratorService</serviceID>
		<description>reload Event Generator</description>
		<name>reload</name>
	</EventGeneratorConfiguration>
	<EventConsumerConfiguration>
		<id></id>
		<name>reload_consumer</name>
		<description>reload consumer</description>
		
		<listenerId>Logger</listenerId>
		<listenerId>Cumulator</listenerId>

		<workingDirectory>reload</workingDirectory>
		<performBackup>false</performBackup>
		<preserveInput>false</preserveInput>
		<FileEventRule>
			<optional>false</optional>
			<originalOccurrencies>1</originalOccurrencies>
			<regex>.*\..*</regex>
			<id>r1</id>
			<description>reload rule</description>
			<name>reload</name>
		</FileEventRule>
		
<!-- 
		<ImageMosaicActionConfiguration>
			<workingDirectory>reload</workingDirectory>

		        <listenerId>Logger</listenerId>
			<listenerId>Cumulator</listenerId>
			<listenerId>Status</listenerId>						

			<crs>EPSG:4326</crs>

			<envelope/>
			<dataTransferMethod>EXTERNAL</dataTransferMethod>
			<geoserverUID>admin</geoserverUID>
			<geoserverPWD>geoserver</geoserverPWD>
			<geoserverURL>http://localhost:8080/geoserver</geoserverURL>
			<defaultNamespace></defaultNamespace>
			<defaultStyle>raster</defaultStyle>

			<wmsPath>/</wmsPath>
			<backgroundValue>NaN</backgroundValue>
			<outputTransparentColor/>
			<inputTransparentColor/>
			<allowMultithreading>true</allowMultithreading>
			<useJaiImageRead>false</useJaiImageRead>

			<tileSizeH>256</tileSizeH>
			<tileSizeW>256</tileSizeW>
			
			<NativeMinBoundingBoxX>-180</NativeMinBoundingBoxX>

			<NativeMinBoundingBoxY>-90</NativeMinBoundingBoxY>

			<NativeMaxBoundingBoxX>180</NativeMaxBoundingBoxX>

			<NativeMaxBoundingBoxY>90</NativeMaxBoundingBoxY>

			<latLonMinBoundingBoxX>-180</latLonMinBoundingBoxX>

			<latLonMinBoundingBoxY>-90</latLonMinBoundingBoxY>

			<latLonMaxBoundingBoxX>180</latLonMaxBoundingBoxX>

			<latLonMaxBoundingBoxY>90</latLonMaxBoundingBoxY>
			
			<projectionPolicy>NONE</projectionPolicy>
			
			<timeDimEnabled>true</timeDimEnabled>
			
			<timePresentationMode>LIST</timePresentationMode>
			<elevDimEnabled>true</elevDimEnabled>
			<elevationPresentationMode>LIST</elevationPresentationMode>
			
			<styles/>
			
			
			<timeRegex>[0-9]{8}T[0-9]{9}Z(\?!.\*[0-9]{8}T[0-9]{9}Z.\*)</timeRegex>
			<elevationRegex><![CDATA[(?<=_)(\\d{4}\\.\\d{3})(?=_)]]></elevationRegex>

			<serviceID>ImageMosaicGeneratorService</serviceID>
			<id>ImageMosaicService</id>
			<description>ImageMosaicService</description>
			<name>ImageMosaicService</name>
		</ImageMosaicActionConfiguration>

-->

		<GeoServerReloadConfiguration>
			<serviceID>GeoServerReloadService</serviceID>
			<id>GeoServerReloadAction</id>
			<name>GeoServerReloadAction</name>
			<description>GeoServerReload</description>

		        <listenerId>Logger</listenerId>
			<listenerId>Cumulator</listenerId>
			<listenerId>Status</listenerId>
			
			<dirty>false</dirty>
			<failIgnored>false</failIgnored>
		  
			<geoserverList>reload/GeoServerList.xml</geoserverList>
			<executorSize>10</executorSize>
			
			<workingDirectory>reload</workingDirectory>
			
		</GeoServerReloadConfiguration>
		
	</EventConsumerConfiguration>
	<ListenerConfigurations>
		<LoggingProgressListener>
			<serviceID>loggingListenerService</serviceID>
			<id>Logger</id>
			<loggerName>it.geosolutions.geobatch</loggerName>
		</LoggingProgressListener>
		<CumulatingProgressListener>
			<serviceID>cumulatingListenerService</serviceID>
			<id>Cumulator</id>
		</CumulatingProgressListener>
		<StatusProgressListener>
			<serviceID>statusListenerService</serviceID>
			<id>Status</id>
		</StatusProgressListener>
	</ListenerConfigurations>
</FlowConfiguration>
