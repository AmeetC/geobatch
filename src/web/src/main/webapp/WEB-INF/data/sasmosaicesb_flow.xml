<?xml version="1.0" encoding="UTF-8"?>
<FlowConfiguration>
	<id>sasMosaicEsbFlow</id>
	<name>sasMosaicEsbFlow</name>
	<description>Process SAS tiles/mosaics and send events to an ESB</description>

	<workingDirectory>sasmosaicesb_work</workingDirectory>
	<autorun>true</autorun>

	<EventConsumerConfiguration>
		<id>sasmosaicesb_flow</id>
		<name>sasmosaicesb_flow</name>
		<description>sasmosaicesb_flow</description>

        <listenerId>ConsumerLogger0</listenerId>
        <listenerId>Cumulator</listenerId>

		<workingDirectory>sasmosaicesb_work</workingDirectory>
		<performBackup>true</performBackup>

		<FileEventRule>
			<optional>false</optional>
			<originalOccurrencies>1</originalOccurrencies>
			<regex>.*\.xml</regex>
			<id>r1</id>
			<description>description</description>
			<name>test</name>
		</FileEventRule>

        <ComposerConfiguration>
			<id>SASMSC</id>
			<serviceID>ComposerService</serviceID>

			<name>SAS Tiles Mosaic composer</name>
			<description>description</description>

			<listenerId>StatusActionLogger0</listenerId>
            <listenerId>ActionLogger0</listenerId>

			<workingDirectory>sasmosaicesb_work</workingDirectory>
			<outputFormat>GeoTIFF</outputFormat>
			<inputFormats>mat</inputFormats>
			<!--<leavesFolders>stbd;port</leavesFolders>-->
			<!-- outputBaseFolder>H:\temp</outputBaseFolder -->
			<!-- LINUX NAS -->
			<!--outputBaseFolder>/mnt/datastorage/sas/mosaic_output</outputBaseFolder-->
			<!-- LINUX LOCAL -->
			<outputBaseFolder>G:\data\sas\output</outputBaseFolder>
			<JAICacheCapacity>768</JAICacheCapacity>
	    	<JAIParallelism>8</JAIParallelism>
			<JAICacheThreshold>1</JAICacheThreshold>
			<numSteps>6</numSteps>
			<downsampleStep>2</downsampleStep>
			<rawScaleAlgorithm>nn</rawScaleAlgorithm>
			<mosaicScaleAlgorithm>avg</mosaicScaleAlgorithm>
			<tileH>512</tileH>
			<tileW>512</tileW>
			<chunkW>10240</chunkW>
			<chunkH>10240</chunkH>
			<compressionRatio>0.75</compressionRatio>
			<compressionScheme>LZW</compressionScheme>
<!--		<geoserverURL>http://192.168.1.17:8086/geoserver</geoserverURL>
			<geoserverUID>admin</geoserverUID>
			<geoserverPWD>geoserver</geoserverPWD>
			<geoserverUploadMethod>EXTERNAL</geoserverUploadMethod>
-->			<corePoolSize>3</corePoolSize>
			<maxPoolSize>3</maxPoolSize>
			<maxWaitingTime>300</maxWaitingTime>
		</ComposerConfiguration>
        
        <SasEsbConfiguration>
			<id>sasMosaicESB</id>
			<serviceID>sasEsbService</serviceID>
			<name>SAS Mosaic ESB</name>
			<description>Sends SOAP messages to ESB</description>

			<listenerId>StatusActionLogger0</listenerId>
            <listenerId>ActionLogger0</listenerId>

            <serverURL>http://192.168.1.10:9090/sas-service/soap</serverURL>
            <geoserverURL>http://192.168.1.10:8080/geoserver-sas</geoserverURL>
        </SasEsbConfiguration>

        <!-- if we wish to directly configure geoserver -->
        <!--
        <SAS2GSConverter>
            <geotiffStyle>GEOTIFFSTYLENAME</geotiffStyle>
            <mosaicStyle>MOSAICSTYLENAME</mosaicStyle>
        </SAS2GSConverter>
        <GeoServerPublisher>
			<geoserverURL>http://192.168.1.17:8086/geoserver</geoserverURL>
			<geoserverUID>admin</geoserverUID>
			<geoserverPWD>geoserver</geoserverPWD>
        </GeoServerPublisher>
        -->

	</EventConsumerConfiguration>

    <EventGeneratorConfiguration>
        <id>id</id>
        <name>test</name>
        <description>description</description>
        <serviceID>fsEventGeneratorService</serviceID>
        
        <wildCard>*.*</wildCard>
        <watchDirectory>sasmosaicesb_work/in</watchDirectory>
        <keepFiles>true</keepFiles>
        <osType>OS_UNDEFINED</osType>
        <eventType>FILE_ADDED</eventType>
    </EventGeneratorConfiguration>
    	
    <ListenerConfigurations>
    	<StatusProgressListener>
    		<serviceID>statusListenerService</serviceID>
            <id>StatusActionLogger0</id>
    	</StatusProgressListener>
    	
        <LoggingProgressListener>
            <serviceID>loggingListenerService</serviceID>
            <id>ActionLogger0</id>

            <loggerName>ActionLogger</loggerName>
        </LoggingProgressListener>

        <LoggingProgressListener>
            <serviceID>loggingListenerService</serviceID>
            <id>ConsumerLogger0</id>

            <loggerName>ConsLogger</loggerName>
        </LoggingProgressListener>

        <CumulatingProgressListener>
            <serviceID>cumulatingListenerService</serviceID>
            <id>Cumulator</id>
        </CumulatingProgressListener>

    </ListenerConfigurations>
    
</FlowConfiguration>